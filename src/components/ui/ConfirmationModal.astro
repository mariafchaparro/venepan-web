---
interface Props {
  id: string;
  title?: string;
  message?: string;
  confirmText?: string;
  cancelText?: string;
}

const { 
  id, 
  title = '¿Estás seguro?', 
  message = 'Esta acción no se puede deshacer.', 
  confirmText = 'Confirmar', 
  cancelText = 'Cancelar' 
} = Astro.props;
---

<div id={id} class="hidden fixed inset-0 z-50 items-center justify-center h-full w-full">
    <!-- Overlay/Backdrop -->
    <div id={`${id}-backdrop`} class="fixed inset-0 bg-gray-600 opacity-50 transition-opacity"></div>

    <!-- Modal Content -->
    <div class="relative p-5 w-96 shadow-lg rounded-2xl bg-white z-10">
        <div class="mt-3 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
            </div>
            <h3 class="text-lg leading-6 font-medium text-gray-800" id="modal-title">{title}</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-gray-500" id="modal-message">{message}</p>
            </div>
            <div class="items-center px-4 py-3">
                <button
                    id={`${id}-confirm`}
                    class="dashboard-btn bg-red-600 hover:bg-red-700 w-full"
                >
                    {confirmText}
                </button>
                <button
                    id={`${id}-cancel`}
                    class="dashboard-btn bg-white hover:bg-gray-100 w-full text-gray-700 border border-gray-300 mt-2"
                >
                    {cancelText}
                </button>
            </div>
        </div>
    </div>
</div>

<script define:vars={{ id }}>
    const modal = document.getElementById(id);
    const backdrop = document.getElementById(`${id}-backdrop`);
    const cancelButton = document.getElementById(`${id}-cancel`);
    const messageElement = document.getElementById('modal-message');
    // Guardar mensaje original
    const originalMessage = messageElement ? messageElement.innerText : '';
    
    // Usamos let para actualizar la referencia tras el replaceChild
    let currentConfirmBtn = document.getElementById(`${id}-confirm`);

    // Función para cerrar el modal
    function closeModal() {
        if (modal) {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }
    }

    if (cancelButton) {
        cancelButton.addEventListener('click', closeModal);
    }
    
    // Cerrar al hacer click en el backdrop
    if (backdrop) {
        backdrop.addEventListener('click', closeModal);
    }
    
    // Mantener compatibilidad con clicks en el contenedor principal si fuera necesario
    if (modal) {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });
    }

    // Exponer función para abrir
    window[`openModal_${id}`] = (callback, customMessage) => {
        if (modal) {
            // Actualizar mensaje si se proporciona
            if (messageElement) {
                messageElement.innerText = customMessage || originalMessage;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
        
        // Manejar confirmación
        if (currentConfirmBtn) {
            const newBtn = currentConfirmBtn.cloneNode(true);
            currentConfirmBtn.parentNode.replaceChild(newBtn, currentConfirmBtn);
            currentConfirmBtn = newBtn;
            
            currentConfirmBtn.addEventListener('click', () => {
                 closeModal();
                 if (callback) callback();
            });
        }
    };
</script>
